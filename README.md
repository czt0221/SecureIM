# SecureIM - 安全即时通讯软件

SecureIM 是一个安全即时通讯桌面应用程序。采用混合加密方案，结合了非对称（RSA）和对称（AES）加密的优点，以确保所有通信的私密性和安全性。应用支持通过服务器中继消息（C/S模式）和直接的点对点连接（P2P模式），为用户提供灵活高效的通讯体验。

## 📂 项目结构

```
SecureIM/
├── data/
│   └── server.db         # 服务器数据库文件
├── .secure_im/           # (位于用户主目录) 客户端私钥存储
│   └── private_key.pem
├── README.md               # 项目介绍文档
├── requirements.txt        # 项目依赖的Python包
├── run_client.py           # 客户端启动脚本
├── run_server.py           # 服务器启动脚本
└── src/
    └── secureim/
        ├── __init__.py
        ├── client/
        │   ├── __init__.py
        │   ├── main.py             # App入口和主控制器
        │   ├── logic.py            # 客户端核心业务逻辑
        │   ├── networking.py       # 封装客户端网络通信
        │   └── ui/
        │       ├── __init__.py
        │       ├── login_window.py # 登录窗口UI
        │       └── main_window.py  # 主聊天窗口UI
        │   └── utils/
        │       ├── __init__.py
        │       ├── crypto.py       # 加密工具模块
        │       └── steganography.py# 隐写术工具模块
        └── server/
            ├── __init__.py
            ├── main.py             # 服务器入口
            ├── connection_handler.py# 处理单个客户端连接
            ├── request_handler.py  # 处理客户端的各种请求
            ├── state.py            # 维护服务器的共享状态（如在线用户）
            └── database.py         # 数据库操作模块

```

## ✨ 主要功能

- **🔒 端到端加密**: 所有消息都使用AES进行加密，确保只有对话双方可以阅读内容。会话密钥本身通过RSA进行非对称加密传输。
- **👥 账户安全**:
    - **强制邮箱**：用户注册时必须提供有效的邮箱地址。
    - **密码策略**：密码长度需至少为8位，且必须包含字母和数字的组合。
    - **灵活登录**：支持使用用户名或注册邮箱进行登录。
- **🌐 混合通信模式**:
    - **C/S 模式**: 默认通过服务器中继消息，保证通信的可靠性。服务器终端会打印中继日志，便于监控。
    - **P2P 模式**: 用户可尝试与好友建立直接的点对点连接以降低延迟。
    - **连接状态反馈**: 客户端会明确提示P2P连接的 **正在尝试...**、**成功** 或 **失败** 状态，让用户清晰了解当前连接模式。
- **🖼️ 隐写术**: 能够将文本消息隐藏在图片中发送，为敏感信息提供额外的安全层。
- **📄 文件传输**: 支持在加密会话中安全地发送和接收文件。
- **🟢 好友系统与在线状态**: 添加和管理您的联系人，并实时查看好友的在线状态。
- **🖥️ 跨平台**: 基于Python和PyQt6构建，可在Windows、macOS和Linux上运行。

## 🔑 密钥管理

客户端在首次启动时，会自动在用户的主目录下生成一个RSA私钥，并将其保存在：
- **Windows**: `C:\\Users\\<YourUsername>\\.secure_im\\private_key.pem`
- **Linux/macOS**: `/home/<YourUsername>/.secure_im/private_key.pem`

此私钥用于解密会话密钥，是安全通信的核心，请勿删除或泄露。

## 🚀 如何运行

### 1. 环境设置

克隆本仓库到本地：
```bash
git clone https://github.com/mobpoly/SecureIM
```

安装所需的依赖项：
```bash
pip install -r requirements.txt
```

### 2. 运行服务器

服务器需要先于任何客户端启动。它负责处理用户注册、登录、信息验证和消息中继。

在项目根目录下运行：
```bash
python run_server.py
```
服务器启动后，会自动在 `./data/` 目录下创建 `server.db` 数据库文件。

### 3. 运行客户端

可以启动多个客户端实例来模拟对话。

在项目根目录下，为每个需要模拟的用户打开一个新的终端并运行：
```bash
python run_client.py
```

- **注册**: 在第一个客户端上，使用唯一的用户名、符合策略的密码和有效邮箱创建一个新帐户。
- **登录**: 使用注册时填写的 **用户名** 或 **邮箱** 及密码进行登录。
- **添加好友**: 与朋友（另一个客户端实例）通过用户名添加对方为好友。
- **开始聊天**: 在好友列表中选择一个在线的好友开始安全通信。默认使用C/S模式。
- **切换模式**: 在好友列表右键点击好友，可以选择切换到P2P模式。界面上会显示连接状态。

## 🛠️ 技术栈

- **语言**: Python 3
- **GUI**: PyQt6
- **加密**: `cryptography` 库 (RSA-OAEP, AES-GCM)
- **图像处理**: `Pillow`
- **数据库**: `sqlite3`
